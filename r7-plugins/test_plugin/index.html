<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Plugin name</title>
        <script type="text/javascript" src="../v1/plugins.js"></script>
        <script type="text/javascript" src="../v1/plugins-ui.js"></script>
        <script src="https://code.jquery.com/jquery-2.2.4.js"></script>
        
        <script type="text/javascript" src="code3.js"></script>
        
        <style>
            #progress {width:0; height:100%; background-color:#ccc;}
            #progress-bar {width:100px; height:20px; border:1px solid #888;}
        </style>
    
    </head>
    <body style="width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;">
       <script>
            function setTask(){ 
                return $.ajax({
                    url: 'http://localhost:8000/new_task/10',
                    method: 'post',
                    dataType: 'json',
                    data: '',
                    success: function(respond, status, jqXHR){
                        console.log(respond);
                        uid=respond.uid;
                    }
                });
            };

            async function onStart() {
                try {
                    const res = await setTask()
                    uid=res.uid;
                    // console.log(uid)
                    getStatus(uid);
                } catch(err) {
                    console.log(err);
                }
            }

            function getStatus(uid) {
                console.log('http://localhost:8000/task/'+uid+'/status');
                    $.ajax({
                    url: 'http://localhost:8000/task/'+uid+'/status',
                    dataType: 'json',
                    complete: function(respond, status, jqXHR) {
                        var data=respond.responseJSON;
                        var status_task=data.status;
                        if(status_task!='complete')
                        // setTimeout(doAjax(arg++,uid),1000); //now that the request is complete, do it again in 1 second
                        {
                            getStatus(uid);
                        }
                        else{
                            console.log('complete');
                            console.log(data.progress);
                        }
                        var proc={
                            total:9,
                            loaded:data.progress,
                            lengthComputable:true
                        };
                        updateProgress(proc);
                    }
                });
            }
            // doAjax();
        </script>

        <div id="progress-bar">
            <div id="progress"></div>
        </div>

        <script>
        const progressbar = document.getElementById("progress-bar");
        const progress = document.getElementById("progress");
        // отслеживаем прогресс загрузки
        function updateProgress(e) {  
            if (e.lengthComputable) {    
                const percentLoaded = Math.round((e.loaded / e.total) * 100);    
                if (percentLoaded <= 100) {      
                    progress.style.width = percentLoaded + "%";      
                    progress.textContent = percentLoaded + "%";
                } 
            }
        }
        function doStart(){
            console.log("ttt");
            console.log(window.myVar);
            console.log(window.myVar_int);
            onStart();
        }
        </script> 
    </body>
</html>